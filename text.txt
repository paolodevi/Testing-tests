function saveCombinedAnimation(frames1, frames2, fps, outFile)
%SAVE COMBINED ANIMATION Combine two frame structs side by side into a video.
%
% Example:
%   saveCombinedAnimation(framesA, framesB, 30, 'combined.mp4')

    if nargin < 3, fps = 30; end
    if nargin < 4, outFile = 'combined.mp4'; end

    % Determine number of frames
    nFrames = min(length(frames1), length(frames2));

    % Ensure same height (resize first frame, then all)
    sz1 = size(frames1(1).cdata);
    sz2 = size(frames2(1).cdata);
    targetH = min(sz1(1), sz2(1));
    targetW1 = round(sz1(2) * targetH / sz1(1));
    targetW2 = round(sz2(2) * targetH / sz2(1));

    % Initialize video writer (hardware accelerated)
    v = VideoWriter(outFile, 'MPEG-4');
    v.FrameRate = fps;
    open(v);

    fprintf('Writing combined video: %s\n', outFile);

    for k = 1:nFrames
        img1 = imresize(frames1(k).cdata, [targetH, targetW1]);
        img2 = imresize(frames2(k).cdata, [targetH, targetW2]);

        if ~isa(img1, 'uint8')
            img1 = im2uint8(img1);
        end
        if ~isa(img2, 'uint8')
            img2 = im2uint8(img2);
        end

        combined = [img1, img2];
        writeVideo(v, combined);
    end

    close(v);
    fprintf('âœ… Done! Saved to %s\n', outFile);
end