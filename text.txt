Perfect — thanks for the clarification about constant structural damping.
That allows us to be very precise and fully consistent.

I will proceed in two clearly separated parts:


---

PART I — Rigorous theory of Method A (modal FRF decomposition with known modes)

We will be explicit about:

assumptions,

damping model,

modal expansion,

definition of participation.


No hand-waving.


---

1. Governing equations with structural damping

You have a linear system governed by:

\mathbf{M}\ddot{\mathbf{x}}(t) + \mathbf{K}(1+i g_S)\mathbf{x}(t) = \mathbf{f}(t)

where:

 is real symmetric positive definite,

 is real symmetric positive definite,

 is a constant structural damping factor,

damping is frequency independent and acts on stiffness.


This is equivalent to using a complex stiffness matrix:

\mathbf{K}_c = (1+i g_S)\mathbf{K}


---

2. Frequency-domain formulation (FRF definition)

Assume harmonic excitation:

\mathbf{f}(t) = \Re\{\mathbf{F} e^{i\omega t}\}
\quad \Rightarrow \quad
\mathbf{x}(t) = \Re\{\mathbf{X} e^{i\omega t}\}

Substitution gives:

\left[ (1+i g_S)\mathbf{K} - \omega^2 \mathbf{M} \right]\mathbf{X}(\omega)
=
\mathbf{F}(\omega)

The receptance FRF matrix is:

\boxed{
\mathbf{H}(\omega)
=
\left[ (1+i g_S)\mathbf{K} - \omega^2 \mathbf{M} \right]^{-1}
}


---

3. Modal basis and orthogonality

You already have eigenpairs from the undamped problem:

\mathbf{K}\boldsymbol{\phi}_r
=
\omega_r^2 \mathbf{M}\boldsymbol{\phi}_r

Assume:

modes are real,

system is classically symmetric.


Modal orthogonality:

\boldsymbol{\phi}_r^T \mathbf{M}\boldsymbol{\phi}_s = 0 \quad (r \neq s)

\boldsymbol{\phi}_r^T \mathbf{K}\boldsymbol{\phi}_s = 0 \quad (r \neq s) 

Define modal mass:

m_r = \boldsymbol{\phi}_r^T \mathbf{M}\boldsymbol{\phi}_r


---

4. Modal normalization (critical step)

We must normalize the modes.

Use mass normalization:

\tilde{\boldsymbol{\phi}}_r = \frac{\boldsymbol{\phi}_r}{\sqrt{m_r}}
\quad\Rightarrow\quad
\tilde{\boldsymbol{\phi}}_r^T \mathbf{M} \tilde{\boldsymbol{\phi}}_r = 1

After normalization:

\tilde{\boldsymbol{\phi}}_r^T \mathbf{K} \tilde{\boldsymbol{\phi}}_r = \omega_r^2

This step is not optional if you want a rigorous modal decomposition.


---

5. Modal expansion of the FRF (with structural damping)

Expand the displacement as:

\mathbf{X}(\omega) = \sum_{r=1}^N q_r(\omega)\tilde{\boldsymbol{\phi}}_r

Substitute into the frequency-domain equation and project onto mode :

\left[(1+i g_S)\omega_r^2 - \omega^2\right] q_r(\omega)
=
\tilde{\boldsymbol{\phi}}_r^T \mathbf{F}(\omega)

Therefore:

\boxed{
q_r(\omega)
=
\frac{\tilde{\boldsymbol{\phi}}_r^T \mathbf{F}(\omega)}
{(1+i g_S)\omega_r^2 - \omega^2}
}


---

6. Modal decomposition of the FRF

Consider the FRF between DOF  (force) and DOF  (response):

H_{ij}(\omega)
=
\frac{X_i(\omega)}{F_j(\omega)}

Using the expansion:

\boxed{
H_{ij}(\omega)
=
\sum_{r=1}^N
\frac{\tilde{\phi}_{ir}\tilde{\phi}_{jr}}
{(1+i g_S)\omega_r^2 - \omega^2}
}

This equation is exact (within modal truncation).


---

7. Definition of modal contribution (Method A)

Define the modal FRF contribution of mode :

\boxed{
H_{ij}^{(r)}(\omega)
=
\frac{\tilde{\phi}_{ir}\tilde{\phi}_{jr}}
{(1+i g_S)\omega_r^2 - \omega^2}
}

This is not a heuristic — it is a mathematically exact term.


---

8. Modal participation factor (rigorous definition)

Because contributions are complex and overlapping, participation is not unique.
A rigorous and commonly accepted choice is magnitude-based normalization:

\boxed{
P_r(\omega)
=
\frac{\left|H_{ij}^{(r)}(\omega)\right|}
{\sum_{k=1}^N \left|H_{ij}^{(k)}(\omega)\right|}
}

Properties:





Peaks near 

Works with overlapping modes


This is what you mean by modal participation along the FRF.


---

PART II — Exact MATLAB implementation

Now we translate the theory line by line.


---

1. Inputs you must provide

M      % Mass matrix (NxN)
K      % Stiffness matrix (NxN)
Phi    % Eigenvectors (Nx x Nmodes)
omega  % Natural frequencies (rad/s), size Nmodes x 1
gS     % Structural damping factor (scalar)
f      % Frequency vector (Hz)
iDOF   % Response DOF index
jDOF   % Force DOF index


---

2. Modal mass normalization

Nmodes = size(Phi,2);

Phi_n = Phi;          % normalized modes
omega_n = omega(:);   % ensure column

for r = 1:Nmodes
    m_r = Phi(:,r).' * M * Phi(:,r);
    Phi_n(:,r) = Phi(:,r) / sqrt(m_r);
end

After this:

Phi_n(:,r).' * M * Phi_n(:,r) == 1


---

3. Frequency vector in rad/s

w = 2*pi*f(:);   % column vector
Nf = length(w);


---

4. Compute modal FRF contributions

H_modal = zeros(Nmodes, Nf);

for r = 1:Nmodes
    num = Phi_n(iDOF,r) * Phi_n(jDOF,r);
    den = (1 + 1i*gS) * omega_n(r)^2 - w.^2;
    H_modal(r,:) = num ./ den;
end

Each row of H_modal is:

H_{ij}^{(r)}(\omega)


---

5. Reconstruct total FRF (validation step)

H_total = sum(H_modal,1);

You must compare this to your trusted FRF.

If they don’t match:

missing modes,

inconsistent normalization,

wrong FRF type.



---

6. Compute modal participation factors

Habs = abs(H_modal);
P = Habs ./ sum(Habs,1);

Now:

sum(P(:,k)) == 1   % for every frequency k


---

7. Typical plots

figure; hold on; grid on;
plot(f, abs(H_total), 'k', 'LineWidth', 1.5)

for r = 1:Nmodes
    plot(f, abs(H_modal(r,:)))
end

xlabel('Frequency [Hz]')
ylabel('|H_{ij}(\omega)|')
legend('Total FRF','Mode 1','Mode 2',...)

And participation:

figure; hold on; grid on;
for r = 1:Nmodes
    plot(f, P(r,:), 'LineWidth', 1.2)
end

xlabel('Frequency [Hz]')
ylabel('Modal participation')


---

8. Important theoretical notes (do not skip)

1. Structural damping preserves modal orthogonality
This is why the modal expansion remains valid.


2. No complex modes are needed
Constant structural damping does not require complex eigenvectors.


3. Participation is FRF-dependent
Change DOFs → participation changes (correctly).


4. Modal truncation matters
Missing high-frequency modes distort low-frequency participation.




---

9. Final takeaway

What you are doing here is:

> Exact modal filtering of an FRF using a known modal basis with structural damping



This is:

theoretically sound,

numerically robust,

much cleaner than adapting LSCF/LSFD,

exactly aligned with your original intuition.


If you want, next we can:

generalize this to full FRF matrices,

define energy-based participation,

or discuss how many modes are needed for convergence.


Just tell me where you want to go next.