% Number of stages
M = numel(matches);

% Initialize paths from reference
paths = matches{1}(1, :).';   % each row = one path

for i = 1:M
    src = matches{i}(1, :);
    dst = matches{i}(2, :);

    newPaths = [];

    for p = 1:size(paths, 1)
        lastVal = paths(p, end);

        % Find all matches for last value
        idx = (src == lastVal);
        nextVals = dst(idx);

        % Expand path
        for v = 1:numel(nextVals)
            newPaths = [
                newPaths
                paths(p, :) nextVals(v)
            ];
        end
    end

    % Move to next stage
    paths = newPaths;

    % Early exit if everything dies
    if isempty(paths)
        break
    end
end